buildarch=4

pkgname=MiSTer-devel
pkgver=88.g78ed888d
pkgrel=1
pkgdesc="MiSTerFPGA distribution package"
arch=('any')
url='https://github.com/MiSTer-devel/Distribution_MiSTer'
license=('GPL3')
source=('git+https://github.com/MiSTer-devel/Distribution_MiSTer.git#branch=main')
sha256sums=('SKIP')
_gitfolder="Distribution_MiSTer"

pkgver() {
  cd "${srcdir}/${_gitfolder}"
  # there are no tags in this repo, so let's just make make one for the first commit
  git tag -f "firstcommit" 5568130ab4f7e6b5780ffa65549b0a7c49d4e770
  # and then use number of commits as a version
  git describe --tags --match firstcommit | sed 's/firstcommit.//g;s/-/./g'
}

package() {
  install ${srcdir}/${_gitfolder}/MiSTer  -Dt "${pkgdir}"/usr/bin/
  install ${srcdir}/${_gitfolder}/menu.rbf  -Dt "${pkgdir}"/boot/

  mkdir -p "${pkgdir}"/media/fat/_Arcade/
  mkdir -p "${pkgdir}"/media/fat/_Computer/
  mkdir -p "${pkgdir}"/media/fat/_Console/
  mkdir -p "${pkgdir}"/media/fat/_Other/
  mkdir -p "${pkgdir}"/media/fat/_Utility/
  mkdir -p "${pkgdir}"/media/fat/Cheats/
  mkdir -p "${pkgdir}"/media/fat/Filters/
  mkdir -p "${pkgdir}"/media/fat/Filters_Audio/
  mkdir -p "${pkgdir}"/media/fat/font/
  mkdir -p "${pkgdir}"/media/fat/games/
  mkdir -p "${pkgdir}"/media/fat/linux/
  mkdir -p "${pkgdir}"/media/fat/Gamma/
  mkdir -p "${pkgdir}"/media/fat/Presets/
  mkdir -p "${pkgdir}"/media/fat/Scripts/
  mkdir -p "${pkgdir}"/media/fat/Shadow_Masks/

  cp -r ${srcdir}/${_gitfolder}/_Arcade/* "${pkgdir}"/media/fat/_Arcade/
  cp -r ${srcdir}/${_gitfolder}/_Computer/* "${pkgdir}"/media/fat/_Computer/
  cp -r ${srcdir}/${_gitfolder}/_Console/* "${pkgdir}"/media/fat/_Console/
  cp -r ${srcdir}/${_gitfolder}/_Other/* "${pkgdir}"/media/fat/_Other/
  cp -r ${srcdir}/${_gitfolder}/_Utility/* "${pkgdir}"/media/fat/_Utility/
  cp -r ${srcdir}/${_gitfolder}/Cheats/* "${pkgdir}"/media/fat/Cheats/
  cp -r ${srcdir}/${_gitfolder}/Filters/* "${pkgdir}"/media/fat/Filters/
  cp -r ${srcdir}/${_gitfolder}/Filters_Audio/* "${pkgdir}"/media/fat/Filters_Audio/
  cp -r ${srcdir}/${_gitfolder}/font/* "${pkgdir}"/media/fat/font/
  cp -r ${srcdir}/${_gitfolder}/games/* "${pkgdir}"/media/fat/games/
  cp -r ${srcdir}/${_gitfolder}/linux/* "${pkgdir}"/media/fat/linux/
  cp -r ${srcdir}/${_gitfolder}/Gamma/* "${pkgdir}"/media/fat/Gamma/
  cp -r ${srcdir}/${_gitfolder}/Presets/* "${pkgdir}"/media/fat/Presets/
  cp -r ${srcdir}/${_gitfolder}/Scripts/* "${pkgdir}"/media/fat/Scripts/
  cp -r ${srcdir}/${_gitfolder}/Shadow_Masks/* "${pkgdir}"/media/fat/Shadow_Masks/
}
